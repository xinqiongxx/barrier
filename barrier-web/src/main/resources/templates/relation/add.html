<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>出入人员管理</title>
    <!--框架必需start-->
    <script type="text/javascript" th:src="@{/static/js/public/base-util.js}" src="../../static/js/public/base-util.js"></script>
    <script type="text/javascript" th:src="@{/libs/js/jquery.js}" src="../../libs/js/jquery.js"></script>
    <script type="text/javascript" th:src="@{/libs/js/language/cn.js}" src="../../libs/js/language/cn.js"></script>
    <script type="text/javascript" th:src="@{/libs/js/framework.js}" src="../../libs/js/framework.js"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/libs/css/import_basic.css}" href="../../libs/css/import_basic.css"/>
    <link rel="stylesheet" type="text/css" id="skin" prePath="../../"/>
    <link rel="stylesheet" type="text/css" id="customSkin"/>
    <!--框架必需end-->

    <!-- 表单验证start -->
    <script type="text/javascript" th:src="@{/libs/js/form/validationRule.js}" src="../../libs/js/form/validationRule.js"></script>
    <script type="text/javascript" th:src="@{/libs/js/form/validation.js}" src="../../libs/js/form/validation.js"></script>
    <!-- 表单验证end -->

    <!--表单异步提交start-->
    <script type="text/javascript" th:src="@{/libs/js/form/form.js}" src="../../libs/js/form/form.js"></script>
    <!--表单异步提交end-->
    <script type="text/javascript" th:src="@{/libs/js/form/datePicker/WdatePicker.js}" src="../../libs/js/form/datePicker/WdatePicker.js"></script>
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        ctxPath = /*[[@{/}]]*/ '';
        /*]]>*/
    </script>
</head>
<body>
<div class="form_content" id="formContent">
    <!--dom结构部分-->
    <form id="formAdd" method="post">
        <table class="tableStyle" formMode="view">
            <tr>
                <td width="20%"><span class="star">*</span>关联人员：</td>
                <td width="60%">
                    <input type="hidden" id="memberId" name="memberId"/>
                    <input type="hidden" id="id" name="id"/>
                    <input type="text" id="memberName" name="memberName" class="validate[required]"/>
                    <input type="button" value="选择人员" onclick="chooseUser()"/>
                </td>
            </tr>
            <tr>
                <td width="20%"><span class="star">*</span>用户关系：</td>
                <td width="30%">
                    <select id="relationType"  prompt="请选择人员关系" class="validate[required]" ></select>
                </td>
            </tr>
            <tr>
                <td width="20%" >备注：</td>
                <td >
                    <textarea id="remark" name="remark" style="resize: none;width:80%;"></textarea>
                </td>
            </tr>
        </table>
    </form>
</div>

<script type="text/javascript">
    var id = '[[${param.id}]]';


    function chooseUser(){
        var diag = new top.Dialog();
        diag.Title = "关联人员";
        diag.ID="a2"
        diag.URL = ctxPath + "page/relation/member";
        //自定义长度和宽度的设置
        diag.Width = 800;
        diag.Height = 700;
        diag.ShowButtonRow = false;
        diag.show();
    }

    //保存
    function save() {
        var valid = $(formAdd).validationEngine({returnIsValid: true});
        if (valid == true) {
            var relation = {};
            relation.userId = $('#id').val();
            relation.memberId = $('#memberId').val();
            relation.memberName =$("#memberName").val();
            relation.relationType = $("#relationType").attr("relValue");
            var type = 'post';
            $.jsonAjax({
                url: ctxPath + "depotuser/saverelation",
                type: type,
                data: relation,
            }).then(function (res) {
                if (0 == res.code) {
                    if(top.frmright){
                        top.frmright.refresh();
                    }
                    top.Dialog.close()
                } else {
                    top.Toast("showErrorToast", '操作异常');
                }
            }, function () {
                top.Toast("showErrorToast", '提交失败！');
            })
        } else {
            top.Toast("showErrorToast", '表单填写不正确，请按要求填写！');
        }
    }


    $(function () {
        $("#id").val(id);
        $.ajax({
            url: ctxPath + "dict/typeforSelect/parent_type",
            type: 'get',
            data: {},
        }).then(function (res) {
            var data={}
            var list = res.data
            data.list=list
            //赋给data
            $("#relationType").data("data", data)
            //刷新下拉框
            $("#relationType").render();

        })
    })

</script>
</body>
</html>